var PluginSS_Switcher;!function(e){"use strict";var t=PluginSS_Data.l10n||{},s=PluginSS_Switcher={elements:{},init:function(){s.get_elements()&&(s.setup_handlers(),s.set_form_display())},get_elements:function(){return s.elements.switcher=e("#pluginss-container"),!!s.elements.switcher.length&&(s.elements.notices=e("#pluginss-switcher-notices"),s.elements.fieldset_add=s.elements.switcher.find("fieldset.pluginss-add-state"),s.elements.fieldset_manage=s.elements.switcher.find("fieldset.pluginss-manage-states"),s.elements.button_add=s.elements.switcher.find('button[name="add_state"]'),s.elements.button_delete=s.elements.switcher.find('button[name="delete_state"]'),s.elements.button_load=s.elements.switcher.find('button[name="load_state"]'),s.elements.field_name=s.elements.switcher.find('input[name="state_name"]'),s.elements.field_state=s.elements.switcher.find('select[name="state_selector"]'),!0)},setup_handlers:function(){s.elements.field_name.keypress(s.add_state_keypress),s.elements.field_state.change(s.change_state_selector),s.elements.button_add.click(s.save_state),s.elements.button_delete.click(s.delete_state)},add_state_keypress:function(e){13===e.which&&(e.preventDefault(),s.save_state())},save_state:function(t){var n=s.elements.field_name.val();s.set_loading(),e.post(ajaxurl,{action:"pluginss_add_state",name:n,nonce:PluginSS_Data.nonce},function(t){var n=s.elements.notices.find(".pluginss-notice-dummy").clone();"undefined"!=typeof t.success&&t.success?(n.addClass("updated").find("p").html(t.data.message),s.elements.field_state.append('<option value="'+t.data.id+'" selected data-active="1">'+t.data.name+"</option>")):n.addClass("error").find("p").html(t.data.message),s.set_form_display(),s.elements.field_name.val(""),s.unset_loading(),n.removeClass("pluginss-notice-dummy").appendTo(s.elements.notices).show(),setTimeout(function(){n.slideUp(300,function(){e(this).remove()})},5e3)})},delete_state:function(){if(confirm(t.delete_state_confirm)){var n=s.elements.field_state.find("option:selected").val();s.set_loading(),e.post(ajaxurl,{action:"pluginss_delete_state",id:n,nonce:PluginSS_Data.nonce},function(t){var n=s.elements.notices.find(".pluginss-notice-dummy").clone();"undefined"!=typeof t.success&&t.success?(n.addClass("updated").find("p").html(t.data.message),s.elements.field_state.find("option:selected").remove()):n.addClass("error").find("p").html(t.data.message),s.set_form_display(),s.unset_loading(),n.removeClass("pluginss-notice-dummy").appendTo(s.elements.notices).show(),setTimeout(function(){n.slideUp(300,function(){e(this).remove()})},5e3)})}},change_state_selector:function(){s.set_form_display()},set_loading:function(){var e=s.elements.switcher.find("input, select, button");e.prop("disabled",!0),s.elements.switcher.find(".pluginss-form").append('<span class="spinner is-active"></span>')},unset_loading:function(){var e=s.elements.switcher.find("input, select, button"),t=s.elements.switcher.find(".spinner");e.prop("disabled",!1),t.remove()},set_form_display:function(){s.elements.field_state.find("option").length?s.elements.fieldset_manage.show():s.elements.fieldset_manage.hide(),s.elements.field_state.find('option[data-active="1"]').length?(s.elements.fieldset_add.hide(),s.elements.fieldset_manage.removeClass("right-padded")):(s.elements.fieldset_add.show(),s.elements.fieldset_manage.addClass("right-padded")),s.elements.field_state.find("option:selected").attr("data-active")?s.elements.button_load.hide():s.elements.button_load.show()}};e(s.init)}(jQuery);
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInBsdWdpbi1zdGF0ZS1zd2l0Y2hlci5taW4uanMiXSwibmFtZXMiOlsiUGx1Z2luU1NfU3dpdGNoZXIiLCIkIiwibDEwbiIsIlBsdWdpblNTX0RhdGEiLCJhcGkiLCJlbGVtZW50cyIsImluaXQiLCJnZXRfZWxlbWVudHMiLCJzZXR1cF9oYW5kbGVycyIsInNldF9mb3JtX2Rpc3BsYXkiLCJzd2l0Y2hlciIsImxlbmd0aCIsIm5vdGljZXMiLCJmaWVsZHNldF9hZGQiLCJmaW5kIiwiZmllbGRzZXRfbWFuYWdlIiwiYnV0dG9uX2FkZCIsImJ1dHRvbl9kZWxldGUiLCJidXR0b25fbG9hZCIsImZpZWxkX25hbWUiLCJmaWVsZF9zdGF0ZSIsImtleXByZXNzIiwiYWRkX3N0YXRlX2tleXByZXNzIiwiY2hhbmdlIiwiY2hhbmdlX3N0YXRlX3NlbGVjdG9yIiwiY2xpY2siLCJzYXZlX3N0YXRlIiwiZGVsZXRlX3N0YXRlIiwiZSIsIndoaWNoIiwicHJldmVudERlZmF1bHQiLCJuYW1lIiwidmFsIiwic2V0X2xvYWRpbmciLCJwb3N0IiwiYWpheHVybCIsImFjdGlvbiIsIm5vbmNlIiwicmVzcG9uc2UiLCIkbm90aWNlIiwiY2xvbmUiLCJzdWNjZXNzIiwiYWRkQ2xhc3MiLCJodG1sIiwiZGF0YSIsIm1lc3NhZ2UiLCJhcHBlbmQiLCJpZCIsInVuc2V0X2xvYWRpbmciLCJyZW1vdmVDbGFzcyIsImFwcGVuZFRvIiwic2hvdyIsInNldFRpbWVvdXQiLCJzbGlkZVVwIiwidGhpcyIsInJlbW92ZSIsImNvbmZpcm0iLCJjdXJyZW50X3N0YXRlIiwiJGlucHV0cyIsInByb3AiLCIkc3Bpbm5lciIsImhpZGUiLCJhdHRyIiwialF1ZXJ5Il0sIm1hcHBpbmdzIjoiQUFBQSxHQUFJQSxvQkFFSixTQUFXQyxHQUNQLFlBRUEsSUFBSUMsR0FBT0MsY0FBb0IsU0FFM0JDLEVBQU1KLG1CQU9OSyxZQU9BQyxLQUFNLFdBRUdGLEVBQUlHLGlCQUtUSCxFQUFJSSxpQkFFSkosRUFB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LFdBRVBiLEVBQVFjLFFBQVEsSUFBSyxXQUVqQnBELEVBQUVxRCxNQUFNQyxZQUdiLFNBVWYvQixzQkFBdUIsV0FFbkJwQixFQUFJSyxvQkFRUndCLFlBQWEsV0FFVCxHQUFJeUIsR0FBVXRELEVBQUlDLFNBQVNLLFNBQVNJLEtBQUssd0JBRXpDNEMsR0FBUUMsS0FBSyxZQUFZLEdBRXpCdkQsRUFBSUMsU0FBU0ssU0FBU0ksS0FBSyxrQkFBa0JnQyxPQUFPLDRDQVF4REUsY0FBZSxXQUVYLEdBQUlVLEdBQVV0RCxFQUFJQyxTQUFTSyxTQUFTSSxLQUFLLHlCQUNyQzhDLEVBQVd4RCxFQUFJQyxTQUFTSyxTQUFTSSxLQUFLLFdBRTFDNEMsR0FBUUMsS0FBSyxZQUFZLEdBRXpCQyxFQUFTTCxVQVFiOUMsaUJBQWtCLFdBRVRMLEVBQUlDLFNBQVNlLFlBQVlOLEtBQUssVUFBVUgsT0FNekNQLEVBQUlDLFNBQVNVLGdCQUFnQm9DLE9BSjdCL0MsRUFBSUMsU0FBU1UsZ0JBQWdCOEMsT0FPN0J6RCxFQUFJQyxTQUFTZSxZQUFZTixLQUFLLDJCQUEyQkgsUUFFekRQLEVBQUlDLFNBQVNRLGFBQWFnRCxPQUMxQnpELEVBQUlDLFNBQVNVLGdCQUFnQmtDLFlBQVksa0JBSXpDN0MsRUFBSUMsU0FBU1EsYUFBYXNDLE9BQzFCL0MsRUFBSUMsU0FBU1UsZ0JBQWdCMkIsU0FBUyxpQkFHdEN0QyxFQUFJQyxTQUFTZSxZQUFZTixLQUFLLG1CQUFtQmdELEtBQUssZUFFdEQxRCxFQUFJQyxTQUFTYSxZQUFZMkMsT0FJekJ6RCxFQUFJQyxTQUFTYSxZQUFZaUMsUUFLckNsRCxHQUFFRyxFQUFJRSxPQUVQeUQiLCJmaWxlIjoicGx1Z2luLXN0YXRlLXN3aXRjaGVyLm1pbi5qcyIsInNvdXJjZXNDb250ZW50IjpbInZhciBQbHVnaW5TU19Td2l0Y2hlcjtcblxuKGZ1bmN0aW9uICgkKSB7XG4gICAgJ3VzZSBzdHJpY3QnO1xuXG4gICAgdmFyIGwxMG4gPSBQbHVnaW5TU19EYXRhWydsMTBuJ10gfHwge307XG5cbiAgICB2YXIgYXBpID0gUGx1Z2luU1NfU3dpdGNoZXIgPSB7XG5cbiAgICAgICAgLyoqXG4gICAgICAgICAqIGpRdWVyeSBvYmplY3RzIGZvciBlbGVtZW50cy5cbiAgICAgICAgICpcbiAgICAgICAgICogQHNpbmNlIDEuMC4wXG4gICAgICAgICAqL1xuICAgICAgICBlbGVtZW50czoge30sXG5cbiAgICAgICAgLyoqXG4gICAgICAgICAqIEluaXRpYWxpemUgdGhlIG9iamVjdC5cbiAgICAgICAgICpcbiAgICAgICAgICogQHNpbmNlIDEuMC4wXG4gICAgICAgICAqL1xuICAgICAgICBpbml0OiBmdW5jdGlvbiAoKSB7XG5cbiAgICAgICAgICAgIGlmICghYXBpLmdldF9lbGVtZW50cygpKSB7XG5cbiAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGFwaS5zZXR1cF9oYW5kbGVycygpO1xuXG4gICAgICAgICAgICBhcGkuc2V0X2Zvcm1fZGlzcGxheSgpO1xuICAgICAgICB9LFxuXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBHZXRzIGVsZW1lbnRzLlxuICAgICAgICAgKlxuICAgICAgICAgKiBAc2luY2UgMS4wLjBcbiAgICAgICAgICpcbiAgICAgICAgICogQHJldHVybnMge2Jvb2xlYW59XG4gICAgICAgICAqL1xuICAgICAgICBnZXRfZWxlbWVudHM6IGZ1bmN0aW9uICgpIHtcblxuICAgICAgICAgICAgYXBpLmVsZW1lbnRzLnN3aXRjaGVyID0gJCgnI3BsdWdpbnNzLWNvbnRhaW5lcicpO1xuXG4gICAgICAgICAgICBpZiAoIWFwaS5lbGVtZW50cy5zd2l0Y2hlci5sZW5ndGgpIHtcblxuICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgYXBpLmVsZW1lbnRzLm5vdGljZXMgPSAkKCcjcGx1Z2luc3Mtc3dpdGNoZXItbm90aWNlcycpO1xuXG4gICAgICAgICAgICBhcGkuZWxlbWVudHMuZmllbGRzZXRfYWRkID0gYXBpLmVsZW1lbnRzLnN3aXRjaGVyLmZpbmQoJ2ZpZWxkc2V0LnBsdWdpbnNzLWFkZC1zdGF0ZScpO1xuICAgICAgICAgICAgYXBpLmVsZW1lbnRzLmZpZWxkc2V0X21hbmFnZSA9IGFwaS5lbGVtZW50cy5zd2l0Y2hlci5maW5kKCdmaWVsZHNldC5wbHVnaW5zcy1tYW5hZ2Utc3RhdGVzJyk7XG5cbiAgICAgICAgICAgIGFwaS5lbGVtZW50cy5idXR0b25fYWRkID0gYXBpLmVsZW1lbnRzLnN3aXRjaGVyLmZpbmQoJ2J1dHRvbltuYW1lPVwiYWRkX3N0YXRlXCJdJyk7XG4gICAgICAgICAgICBhcGkuZWxlbWVudHMuYnV0dG9uX2RlbGV0ZSA9IGFwaS5lbGVtZW50cy5zd2l0Y2hlci5maW5kKCdidXR0b25bbmFtZT1cImRlbGV0ZV9zdGF0ZVwiXScpO1xuICAgICAgICAgICAgYXBpLmVsZW1lbnRzLmJ1dHRvbl9sb2FkID0gYXBpLmVsZW1lbnRzLnN3aXRjaGVyLmZpbmQoJ2J1dHRvbltuYW1lPVwibG9hZF9zdGF0ZVwiXScpO1xuXG4gICAgICAgICAgICBhcGkuZWxlbWVudHMuZmllbGRfbmFtZSA9IGFwaS5lbGVtZW50cy5zd2l0Y2hlci5maW5kKCdpbnB1dFtuYW1lPVwic3RhdGVfbmFtZVwiXScpO1xuICAgICAgICAgICAgYXBpLmVsZW1lbnRzLmZpZWxkX3N0YXRlID0gYXBpLmVsZW1lbnRzLnN3aXRjaGVyLmZpbmQoJ3NlbGVjdFtuYW1lPVwic3RhdGVfc2VsZWN0b3JcIl0nKTtcblxuICAgICAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICAgIH0sXG5cbiAgICAgICAgLyoqXG4gICAgICAgICAqIFNldHMgdXAgZXZlbnQgaGFuZGxlcnMuXG4gICAgICAgICAqXG4gICAgICAgICAqIEBzaW5jZSAxLjAuMFxuICAgICAgICAgKi9cbiAgICAgICAgc2V0dXBfaGFuZGxlcnM6IGZ1bmN0aW9uICgpIHtcblxuICAgICAgICAgICAgYXBpLmVsZW1lbnRzLmZpZWxkX25hbWUua2V5cHJlc3MoYXBpLmFkZF9zdGF0ZV9rZXlwcmVzcyk7XG4gICAgICAgICAgICBhcGkuZWxlbWVudHMuZmllbGRfc3RhdGUuY2hhbmdlKGFwaS5jaGFuZ2Vfc3RhdGVfc2VsZWN0b3IpO1xuXG4gICAgICAgICAgICBhcGkuZWxlbWVudHMuYnV0dG9uX2FkZC5jbGljayhhcGkuc2F2ZV9zdGF0ZSk7XG4gICAgICAgICAgICBhcGkuZWxlbWVudHMuYnV0dG9uX2RlbGV0ZS5jbGljayhhcGkuZGVsZXRlX3N0YXRlKTtcbiAgICAgICAgfSxcblxuICAgICAgICAvKipcbiAgICAgICAgICogRmlyZXMgaW4gcHJlc3NpbmcgYSBrZXkgd2l0aGluIHRoZSBhZGQgc3RhdGUgdGV4dCBmaWVsZC5cbiAgICAgICAgICpcbiAgICAgICAgICogQHNpbmNlIDEuMC4wXG4gICAgICAgICAqXG4gICAgICAgICAqIEBwYXJhbSBlXG4gICAgICAgICAqL1xuICAgICAgICBhZGRfc3RhdGVfa2V5cHJlc3M6IGZ1bmN0aW9uIChlKSB7XG5cbiAgICAgICAgICAgIGlmIChlLndoaWNoID09PSAxMykge1xuXG4gICAgICAgICAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICAgICAgICAgICAgIGFwaS5zYXZlX3N0YXRlKCk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0sXG5cbiAgICAgICAgLyoqXG4gICAgICAgICAqIFNhdmVzIGEgc3RhdGUuXG4gICAgICAgICAqXG4gICAgICAgICAqIEBzaW5jZSAxLjAuMFxuICAgICAgICAgKi9cbiAgICAgICAgc2F2ZV9zdGF0ZTogZnVuY3Rpb24gKGUpIHtcblxuICAgICAgICAgICAgdmFyIG5hbWUgPSBhcGkuZWxlbWVudHMuZmllbGRfbmFtZS52YWwoKTtcblxuICAgICAgICAgICAgYXBpLnNldF9sb2FkaW5nKCk7XG5cbiAgICAgICAgICAgICQucG9zdChcbiAgICAgICAgICAgICAgICBhamF4dXJsLFxuICAgICAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICAgICAgYWN0aW9uOiAncGx1Z2luc3NfYWRkX3N0YXRlJyxcbiAgICAgICAgICAgICAgICAgICAgbmFtZTogbmFtZSxcbiAgICAgICAgICAgICAgICAgICAgbm9uY2U6IFBsdWdpblNTX0RhdGEubm9uY2VcbiAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgIGZ1bmN0aW9uIChyZXNwb25zZSkge1xuXG4gICAgICAgICAgICAgICAgICAgIHZhciAkbm90aWNlID0gYXBpLmVsZW1lbnRzLm5vdGljZXMuZmluZCgnLnBsdWdpbnNzLW5vdGljZS1kdW1teScpLmNsb25lKCk7XG5cbiAgICAgICAgICAgICAgICAgICAgaWYgKHR5cGVvZiByZXNwb25zZS5zdWNjZXNzID09ICd1bmRlZmluZWQnIHx8ICFyZXNwb25zZS5zdWNjZXNzKSB7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgICRub3RpY2UuYWRkQ2xhc3MoJ2Vycm9yJykuZmluZCgncCcpLmh0bWwocmVzcG9uc2UuZGF0YS5tZXNzYWdlKTtcblxuICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xuXG4gICAgICAgICAgICAgICAgICAgICAgICAkbm90aWNlLmFkZENsYXNzKCd1cGRhdGVkJykuZmluZCgncCcpLmh0bWwocmVzcG9uc2UuZGF0YS5tZXNzYWdlKTtcblxuICAgICAgICAgICAgICAgICAgICAgICAgYXBpLmVsZW1lbnRzLmZpZWxkX3N0YXRlLmFwcGVuZChcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAnPG9wdGlvbiB2YWx1ZT1cIicgKyByZXNwb25zZS5kYXRhLmlkICsgJ1wiIHNlbGVjdGVkIGRhdGEtYWN0aXZlPVwiMVwiPicgK1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlc3BvbnNlLmRhdGEubmFtZSArICc8L29wdGlvbj4nXG4gICAgICAgICAgICAgICAgICAgICAgICApO1xuICAgICAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICAgICAgYXBpLnNldF9mb3JtX2Rpc3BsYXkoKTtcblxuICAgICAgICAgICAgICAgICAgICBhcGkuZWxlbWVudHMuZmllbGRfbmFtZS52YWwoJycpO1xuXG4gICAgICAgICAgICAgICAgICAgIGFwaS51bnNldF9sb2FkaW5nKCk7XG5cbiAgICAgICAgICAgICAgICAgICAgJG5vdGljZS5yZW1vdmVDbGFzcygncGx1Z2luc3Mtbm90aWNlLWR1bW15JykuYXBwZW5kVG8oYXBpLmVsZW1lbnRzLm5vdGljZXMpLnNob3coKTtcblxuICAgICAgICAgICAgICAgICAgICBzZXRUaW1lb3V0KGZ1bmN0aW9uICgpIHtcblxuICAgICAgICAgICAgICAgICAgICAgICAgJG5vdGljZS5zbGlkZVVwKDMwMCwgZnVuY3Rpb24gKCkge1xuXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgJCh0aGlzKS5yZW1vdmUoKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICAgICAgICAgIH0sIDUwMDApO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIClcbiAgICAgICAgfSxcblxuICAgICAgICAvKipcbiAgICAgICAgICogRGVsZXRlcyB0aGUgY3VycmVudCBzdGF0ZS5cbiAgICAgICAgICpcbiAgICAgICAgICogQHNpbmNlIDEuMC4wXG4gICAgICAgICAqL1xuICAgICAgICBkZWxldGVfc3RhdGU6IGZ1bmN0aW9uICgpIHtcblxuICAgICAgICAgICAgaWYgKCFjb25maXJtKGwxMG5bJ2RlbGV0ZV9zdGF0ZV9jb25maXJtJ10pKSB7XG5cbiAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIHZhciBjdXJyZW50X3N0YXRlID0gYXBpLmVsZW1lbnRzLmZpZWxkX3N0YXRlLmZpbmQoJ29wdGlvbjpzZWxlY3RlZCcpLnZhbCgpO1xuXG4gICAgICAgICAgICBhcGkuc2V0X2xvYWRpbmcoKTtcblxuICAgICAgICAgICAgJC5wb3N0KFxuICAgICAgICAgICAgICAgIGFqYXh1cmwsXG4gICAgICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgICAgICBhY3Rpb246ICdwbHVnaW5zc19kZWxldGVfc3RhdGUnLFxuICAgICAgICAgICAgICAgICAgICBpZDogY3VycmVudF9zdGF0ZSxcbiAgICAgICAgICAgICAgICAgICAgbm9uY2U6IFBsdWdpblNTX0RhdGEubm9uY2VcbiAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgIGZ1bmN0aW9uIChyZXNwb25zZSkge1xuXG4gICAgICAgICAgICAgICAgICAgIHZhciAkbm90aWNlID0gYXBpLmVsZW1lbnRzLm5vdGljZXMuZmluZCgnLnBsdWdpbnNzLW5vdGljZS1kdW1teScpLmNsb25lKCk7XG5cbiAgICAgICAgICAgICAgICAgICAgaWYgKHR5cGVvZiByZXNwb25zZS5zdWNjZXNzID09ICd1bmRlZmluZWQnIHx8ICFyZXNwb25zZS5zdWNjZXNzKSB7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgICRub3RpY2UuYWRkQ2xhc3MoJ2Vycm9yJykuZmluZCgncCcpLmh0bWwocmVzcG9uc2UuZGF0YS5tZXNzYWdlKTtcblxuICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xuXG4gICAgICAgICAgICAgICAgICAgICAgICAkbm90aWNlLmFkZENsYXNzKCd1cGRhdGVkJykuZmluZCgncCcpLmh0bWwocmVzcG9uc2UuZGF0YS5tZXNzYWdlKTtcblxuICAgICAgICAgICAgICAgICAgICAgICAgYXBpLmVsZW1lbnRzLmZpZWxkX3N0YXRlLmZpbmQoJ29wdGlvbjpzZWxlY3RlZCcpLnJlbW92ZSgpO1xuICAgICAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICAgICAgYXBpLnNldF9mb3JtX2Rpc3BsYXkoKTtcblxuICAgICAgICAgICAgICAgICAgICBhcGkudW5zZXRfbG9hZGluZygpO1xuXG4gICAgICAgICAgICAgICAgICAgICRub3RpY2UucmVtb3ZlQ2xhc3MoJ3BsdWdpbnNzLW5vdGljZS1kdW1teScpLmFwcGVuZFRvKGFwaS5lbGVtZW50cy5ub3RpY2VzKS5zaG93KCk7XG5cbiAgICAgICAgICAgICAgICAgICAgc2V0VGltZW91dChmdW5jdGlvbiAoKSB7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgICRub3RpY2Uuc2xpZGVVcCgzMDAsIGZ1bmN0aW9uICgpIHtcblxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICQodGhpcykucmVtb3ZlKCk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgICAgICAgICB9LCA1MDAwKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICApXG4gICAgICAgIH0sXG5cbiAgICAgICAgLyoqXG4gICAgICAgICAqIEZpcmVzIHdoZW4gY2hhbmdpbmcgdGhlIGxvYWQgc3RhdGUgc2VsZWN0b3IuXG4gICAgICAgICAqXG4gICAgICAgICAqIEBzaW5jZSAxLjAuMFxuICAgICAgICAgKi9cbiAgICAgICAgY2hhbmdlX3N0YXRlX3NlbGVjdG9yOiBmdW5jdGlvbiAoKSB7XG5cbiAgICAgICAgICAgIGFwaS5zZXRfZm9ybV9kaXNwbGF5KCk7XG4gICAgICAgIH0sXG5cbiAgICAgICAgLyoqXG4gICAgICAgICAqIFNldHMgdGhlIGZvcm0gdG8gbG9hZGluZy5cbiAgICAgICAgICpcbiAgICAgICAgICogQHNpbmNlIDEuMC4wXG4gICAgICAgICAqL1xuICAgICAgICBzZXRfbG9hZGluZzogZnVuY3Rpb24gKCkge1xuXG4gICAgICAgICAgICB2YXIgJGlucHV0cyA9IGFwaS5lbGVtZW50cy5zd2l0Y2hlci5maW5kKCdpbnB1dCwgc2VsZWN0LCBidXR0b24nKTtcblxuICAgICAgICAgICAgJGlucHV0cy5wcm9wKCdkaXNhYmxlZCcsIHRydWUpO1xuXG4gICAgICAgICAgICBhcGkuZWxlbWVudHMuc3dpdGNoZXIuZmluZCgnLnBsdWdpbnNzLWZvcm0nKS5hcHBlbmQoJzxzcGFuIGNsYXNzPVwic3Bpbm5lciBpcy1hY3RpdmVcIj48L3NwYW4+Jyk7XG4gICAgICAgIH0sXG5cbiAgICAgICAgLyoqXG4gICAgICAgICAqIFVuc2V0cyB0aGUgZm9ybSBmcm9tIGxvYWRpbmcuXG4gICAgICAgICAqXG4gICAgICAgICAqIEBzaW5jZSAxLjAuMFxuICAgICAgICAgKi9cbiAgICAgICAgdW5zZXRfbG9hZGluZzogZnVuY3Rpb24gKCkge1xuXG4gICAgICAgICAgICB2YXIgJGlucHV0cyA9IGFwaS5lbGVtZW50cy5zd2l0Y2hlci5maW5kKCdpbnB1dCwgc2VsZWN0LCBidXR0b24nKSxcbiAgICAgICAgICAgICAgICAkc3Bpbm5lciA9IGFwaS5lbGVtZW50cy5zd2l0Y2hlci5maW5kKCcuc3Bpbm5lcicpO1xuXG4gICAgICAgICAgICAkaW5wdXRzLnByb3AoJ2Rpc2FibGVkJywgZmFsc2UpO1xuXG4gICAgICAgICAgICAkc3Bpbm5lci5yZW1vdmUoKTtcbiAgICAgICAgfSxcblxuICAgICAgICAvKipcbiAgICAgICAgICogSGlkZXMvc2hvd3MgcGFydCBvZiB0aGUgZm9ybSBiYXNlZCBvbiB0aGUgY29uZGl0aW9ucy5cbiAgICAgICAgICpcbiAgICAgICAgICogQHNpbmNlIDEuMC4wXG4gICAgICAgICAqL1xuICAgICAgICBzZXRfZm9ybV9kaXNwbGF5OiBmdW5jdGlvbiAoKSB7XG5cbiAgICAgICAgICAgIGlmICghYXBpLmVsZW1lbnRzLmZpZWxkX3N0YXRlLmZpbmQoJ29wdGlvbicpLmxlbmd0aCkge1xuXG4gICAgICAgICAgICAgICAgYXBpLmVsZW1lbnRzLmZpZWxkc2V0X21hbmFnZS5oaWRlKCk7XG5cbiAgICAgICAgICAgIH0gZWxzZSB7XG5cbiAgICAgICAgICAgICAgICBhcGkuZWxlbWVudHMuZmllbGRzZXRfbWFuYWdlLnNob3coKTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgaWYgKGFwaS5lbGVtZW50cy5maWVsZF9zdGF0ZS5maW5kKCdvcHRpb25bZGF0YS1hY3RpdmU9XCIxXCJdJykubGVuZ3RoKSB7XG5cbiAgICAgICAgICAgICAgICBhcGkuZWxlbWVudHMuZmllbGRzZXRfYWRkLmhpZGUoKTtcbiAgICAgICAgICAgICAgICBhcGkuZWxlbWVudHMuZmllbGRzZXRfbWFuYWdlLnJlbW92ZUNsYXNzKCdyaWdodC1wYWRkZWQnKTtcblxuICAgICAgICAgICAgfSBlbHNlIHtcblxuICAgICAgICAgICAgICAgIGFwaS5lbGVtZW50cy5maWVsZHNldF9hZGQuc2hvdygpO1xuICAgICAgICAgICAgICAgIGFwaS5lbGVtZW50cy5maWVsZHNldF9tYW5hZ2UuYWRkQ2xhc3MoJ3JpZ2h0LXBhZGRlZCcpO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBpZiAoYXBpLmVsZW1lbnRzLmZpZWxkX3N0YXRlLmZpbmQoJ29wdGlvbjpzZWxlY3RlZCcpLmF0dHIoJ2RhdGEtYWN0aXZlJykpIHtcblxuICAgICAgICAgICAgICAgIGFwaS5lbGVtZW50cy5idXR0b25fbG9hZC5oaWRlKCk7XG5cbiAgICAgICAgICAgIH0gZWxzZSB7XG5cbiAgICAgICAgICAgICAgICBhcGkuZWxlbWVudHMuYnV0dG9uX2xvYWQuc2hvdygpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgfTtcblxuICAgICQoYXBpLmluaXQpO1xuXG59KShqUXVlcnkpOyJdfQ==
