var PluginSS_Switcher;!function(e){"use strict";var t=PluginSS_Switcher={elements:{},init:function(){t.get_elements()&&(t.setup_handlers(),t.set_form_display())},get_elements:function(){return t.elements.switcher=e("#pluginss-container"),!!t.elements.switcher.length&&(t.elements.notices=e("#pluginss-switcher-notices"),t.elements.fieldset_add=t.elements.switcher.find("fieldset.pluginss-add-state"),t.elements.fieldset_manage=t.elements.switcher.find("fieldset.pluginss-manage-states"),t.elements.button_add=t.elements.switcher.find('button[name="add_state"]'),t.elements.button_delete=t.elements.switcher.find('button[name="delete_state"]'),t.elements.button_load=t.elements.switcher.find('button[name="load_state"]'),t.elements.field_name=t.elements.switcher.find('input[name="state_name"]'),t.elements.field_state=t.elements.switcher.find('select[name="state_selector"]'),!0)},setup_handlers:function(){t.elements.field_name.keypress(t.add_state_keypress),t.elements.field_state.change(t.change_state_selector),t.elements.button_add.click(t.save_state),t.elements.button_delete.click(t.delete_state)},add_state_keypress:function(e){13===e.which&&(e.preventDefault(),t.save_state())},save_state:function(s){var n=t.elements.field_name.val();t.set_loading(),e.post(ajaxurl,{action:"pluginss_add_state",name:n,nonce:PluginSS_Data.nonce},function(s){var n=t.elements.notices.find(".pluginss-notice-dummy").clone();"undefined"!=typeof s.success&&s.success?(n.addClass("updated").find("p").html(s.data.message),t.elements.field_state.append('<option value="'+s.data.id+'" selected data-active="1">'+s.data.name+"</option>")):n.addClass("error").find("p").html(s.data.message),t.set_form_display(),t.elements.field_name.val(""),t.unset_loading(),n.removeClass("pluginss-notice-dummy").appendTo(t.elements.notices).show(),setTimeout(function(){n.slideUp(300,function(){e(this).remove()})},5e3)})},delete_state:function(){var s=t.elements.field_state.find("option:selected").val();t.set_loading(),e.post(ajaxurl,{action:"pluginss_delete_state",id:s,nonce:PluginSS_Data.nonce},function(s){var n=t.elements.notices.find(".pluginss-notice-dummy").clone();"undefined"!=typeof s.success&&s.success?(n.addClass("updated").find("p").html(s.data.message),t.elements.field_state.find("option:selected").remove()):n.addClass("error").find("p").html(s.data.message),t.set_form_display(),t.unset_loading(),n.removeClass("pluginss-notice-dummy").appendTo(t.elements.notices).show(),setTimeout(function(){n.slideUp(300,function(){e(this).remove()})},5e3)})},change_state_selector:function(){t.set_form_display()},set_loading:function(){var e=t.elements.switcher.find("input, select, button");e.prop("disabled",!0),t.elements.switcher.find(".pluginss-form").append('<span class="spinner is-active"></span>')},unset_loading:function(){var e=t.elements.switcher.find("input, select, button"),s=t.elements.switcher.find(".spinner");e.prop("disabled",!1),s.remove()},set_form_display:function(){t.elements.field_state.find("option").length?t.elements.fieldset_manage.show():t.elements.fieldset_manage.hide(),t.elements.field_state.find('option[data-active="1"]').length?(t.elements.fieldset_add.hide(),t.elements.fieldset_manage.removeClass("right-padded")):(t.elements.fieldset_add.show(),t.elements.fieldset_manage.addClass("right-padded")),t.elements.field_state.find("option:selected").attr("data-active")?t.elements.button_load.hide():t.elements.button_load.show()}};e(t.init)}(jQuery);
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInBsdWdpbi1zdGF0ZS1zd2l0Y2hlci5taW4uanMiXSwibmFtZXMiOlsiUGx1Z2luU1NfU3dpdGNoZXIiLCIkIiwiYXBpIiwiZWxlbWVudHMiLCJpbml0IiwiZ2V0X2VsZW1lbnRzIiwic2V0dXBfaGFuZGxlcnMiLCJzZXRfZm9ybV9kaXNwbGF5Iiwic3dpdGNoZXIiLCJsZW5ndGgiLCJub3RpY2VzIiwiZmllbGRzZXRfYWRkIiwiZmluZCIsImZpZWxkc2V0X21hbmFnZSIsImJ1dHRvbl9hZGQiLCJidXR0b25fZGVsZXRlIiwiYnV0dG9uX2xvYWQiLCJmaWVsZF9uYW1lIiwiZmllbGRfc3RhdGUiLCJrZXlwcmVzcyIsImFkZF9zdGF0ZV9rZXlwcmVzcyIsImNoYW5nZSIsImNoYW5nZV9zdGF0ZV9zZWxlY3RvciIsImNsaWNrIiwic2F2ZV9zdGF0ZSIsImRlbGV0ZV9zdGF0ZSIsImUiLCJ3aGljaCIsInByZXZlbnREZWZhdWx0IiwibmFtZSIsInZhbCIsInNldF9sb2FkaW5nIiwicG9zdCIsImFqYXh1cmwiLCJhY3Rpb24iLCJub25jZSIsIlBsdWdpblNTX0RhdGEiLCJyZXNwb25zZSIsIiRub3RpY2UiLCJjbG9uZSIsInN1Y2Nlc3MiLCJhZGRDbGFzcyIsImh0bWwiLCJkYXRhIiwibWVzc2FnZSIsImFwcGVuZCIsImlkIiwidW5zZXRfbG9hZGluZyIsInJlbW92ZUNsYXNzIiwiYXBwZW5kVG8iLCJzaG93Iiwic2V0VGltZW91dCIsInNsaWRlVXAiLCJ0aGlzIiwicmVtb3ZlIiwiY3VycmVudF9zdGF0ZSIsIiRpbnB1dHMiLCJwcm9wIiwiJHNwaW5uZXIiLCJoaWRlIiwiYXR0ciIsImpRdWVyeSJdLCJtYXBwaW5ncyI6IkFBQUEsR0FBSUEsb0JBRUosU0FBV0MsR0FDUCxZQUVBLElBQUlDLEdBQU1GLG1CQU9ORyxZQU9BQyxLQUFNLFdBRUdGLEVBQUlHLGlCQUtUSCxFQUFJSSxpQkFFSkosRUFBSUsscUJBVVJGLGFBQWMsV0FJVixNQUZBSCxHQUFJQyxTQUFT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QUFJSyxvQkFRUndCLFlBQWEsV0FFVCxHQUFJeUIsR0FBVXRELEVBQUlDLFNBQVNLLFNBQVNJLEtBQUssd0JBRXpDNEMsR0FBUUMsS0FBSyxZQUFZLEdBRXpCdkQsRUFBSUMsU0FBU0ssU0FBU0ksS0FBSyxrQkFBa0JpQyxPQUFPLDRDQVF4REUsY0FBZSxXQUVYLEdBQUlTLEdBQVV0RCxFQUFJQyxTQUFTSyxTQUFTSSxLQUFLLHlCQUNyQzhDLEVBQVd4RCxFQUFJQyxTQUFTSyxTQUFTSSxLQUFLLFdBRTFDNEMsR0FBUUMsS0FBSyxZQUFZLEdBRXpCQyxFQUFTSixVQVFiL0MsaUJBQWtCLFdBRVRMLEVBQUlDLFNBQVNlLFlBQVlOLEtBQUssVUFBVUgsT0FNekNQLEVBQUlDLFNBQVNVLGdCQUFnQnFDLE9BSjdCaEQsRUFBSUMsU0FBU1UsZ0JBQWdCOEMsT0FPN0J6RCxFQUFJQyxTQUFTZSxZQUFZTixLQUFLLDJCQUEyQkgsUUFFekRQLEVBQUlDLFNBQVNRLGFBQWFnRCxPQUMxQnpELEVBQUlDLFNBQVNVLGdCQUFnQm1DLFlBQVksa0JBSXpDOUMsRUFBSUMsU0FBU1EsYUFBYXVDLE9BQzFCaEQsRUFBSUMsU0FBU1UsZ0JBQWdCNEIsU0FBUyxpQkFHdEN2QyxFQUFJQyxTQUFTZSxZQUFZTixLQUFLLG1CQUFtQmdELEtBQUssZUFFdEQxRCxFQUFJQyxTQUFTYSxZQUFZMkMsT0FJekJ6RCxFQUFJQyxTQUFTYSxZQUFZa0MsUUFLckNqRCxHQUFFQyxFQUFJRSxPQUVQeUQiLCJmaWxlIjoicGx1Z2luLXN0YXRlLXN3aXRjaGVyLm1pbi5qcyIsInNvdXJjZXNDb250ZW50IjpbInZhciBQbHVnaW5TU19Td2l0Y2hlcjtcblxuKGZ1bmN0aW9uICgkKSB7XG4gICAgJ3VzZSBzdHJpY3QnO1xuXG4gICAgdmFyIGFwaSA9IFBsdWdpblNTX1N3aXRjaGVyID0ge1xuXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBqUXVlcnkgb2JqZWN0cyBmb3IgZWxlbWVudHMuXG4gICAgICAgICAqXG4gICAgICAgICAqIEBzaW5jZSB7e1ZFUlNJT059fVxuICAgICAgICAgKi9cbiAgICAgICAgZWxlbWVudHM6IHt9LFxuXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBJbml0aWFsaXplIHRoZSBvYmplY3QuXG4gICAgICAgICAqXG4gICAgICAgICAqIEBzaW5jZSB7e1ZFUlNJT059fVxuICAgICAgICAgKi9cbiAgICAgICAgaW5pdDogZnVuY3Rpb24gKCkge1xuXG4gICAgICAgICAgICBpZiAoIWFwaS5nZXRfZWxlbWVudHMoKSkge1xuXG4gICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBhcGkuc2V0dXBfaGFuZGxlcnMoKTtcblxuICAgICAgICAgICAgYXBpLnNldF9mb3JtX2Rpc3BsYXkoKTtcbiAgICAgICAgfSxcblxuICAgICAgICAvKipcbiAgICAgICAgICogR2V0cyBlbGVtZW50cy5cbiAgICAgICAgICpcbiAgICAgICAgICogQHNpbmNlIHt7VkVSU0lPTn19XG4gICAgICAgICAqXG4gICAgICAgICAqIEByZXR1cm5zIHtib29sZWFufVxuICAgICAgICAgKi9cbiAgICAgICAgZ2V0X2VsZW1lbnRzOiBmdW5jdGlvbiAoKSB7XG5cbiAgICAgICAgICAgIGFwaS5lbGVtZW50cy5zd2l0Y2hlciA9ICQoJyNwbHVnaW5zcy1jb250YWluZXInKTtcblxuICAgICAgICAgICAgaWYgKCFhcGkuZWxlbWVudHMuc3dpdGNoZXIubGVuZ3RoKSB7XG5cbiAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGFwaS5lbGVtZW50cy5ub3RpY2VzID0gJCgnI3BsdWdpbnNzLXN3aXRjaGVyLW5vdGljZXMnKTtcblxuICAgICAgICAgICAgYXBpLmVsZW1lbnRzLmZpZWxkc2V0X2FkZCA9IGFwaS5lbGVtZW50cy5zd2l0Y2hlci5maW5kKCdmaWVsZHNldC5wbHVnaW5zcy1hZGQtc3RhdGUnKTtcbiAgICAgICAgICAgIGFwaS5lbGVtZW50cy5maWVsZHNldF9tYW5hZ2UgPSBhcGkuZWxlbWVudHMuc3dpdGNoZXIuZmluZCgnZmllbGRzZXQucGx1Z2luc3MtbWFuYWdlLXN0YXRlcycpO1xuXG4gICAgICAgICAgICBhcGkuZWxlbWVudHMuYnV0dG9uX2FkZCA9IGFwaS5lbGVtZW50cy5zd2l0Y2hlci5maW5kKCdidXR0b25bbmFtZT1cImFkZF9zdGF0ZVwiXScpO1xuICAgICAgICAgICAgYXBpLmVsZW1lbnRzLmJ1dHRvbl9kZWxldGUgPSBhcGkuZWxlbWVudHMuc3dpdGNoZXIuZmluZCgnYnV0dG9uW25hbWU9XCJkZWxldGVfc3RhdGVcIl0nKTtcbiAgICAgICAgICAgIGFwaS5lbGVtZW50cy5idXR0b25fbG9hZCA9IGFwaS5lbGVtZW50cy5zd2l0Y2hlci5maW5kKCdidXR0b25bbmFtZT1cImxvYWRfc3RhdGVcIl0nKTtcblxuICAgICAgICAgICAgYXBpLmVsZW1lbnRzLmZpZWxkX25hbWUgPSBhcGkuZWxlbWVudHMuc3dpdGNoZXIuZmluZCgnaW5wdXRbbmFtZT1cInN0YXRlX25hbWVcIl0nKTtcbiAgICAgICAgICAgIGFwaS5lbGVtZW50cy5maWVsZF9zdGF0ZSA9IGFwaS5lbGVtZW50cy5zd2l0Y2hlci5maW5kKCdzZWxlY3RbbmFtZT1cInN0YXRlX3NlbGVjdG9yXCJdJyk7XG5cbiAgICAgICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgICB9LFxuXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBTZXRzIHVwIGV2ZW50IGhhbmRsZXJzLlxuICAgICAgICAgKlxuICAgICAgICAgKiBAc2luY2Uge3tWRVJTSU9OfX1cbiAgICAgICAgICovXG4gICAgICAgIHNldHVwX2hhbmRsZXJzOiBmdW5jdGlvbiAoKSB7XG5cbiAgICAgICAgICAgIGFwaS5lbGVtZW50cy5maWVsZF9uYW1lLmtleXByZXNzKGFwaS5hZGRfc3RhdGVfa2V5cHJlc3MpO1xuICAgICAgICAgICAgYXBpLmVsZW1lbnRzLmZpZWxkX3N0YXRlLmNoYW5nZShhcGkuY2hhbmdlX3N0YXRlX3NlbGVjdG9yKTtcblxuICAgICAgICAgICAgYXBpLmVsZW1lbnRzLmJ1dHRvbl9hZGQuY2xpY2soYXBpLnNhdmVfc3RhdGUpO1xuICAgICAgICAgICAgYXBpLmVsZW1lbnRzLmJ1dHRvbl9kZWxldGUuY2xpY2soYXBpLmRlbGV0ZV9zdGF0ZSk7XG4gICAgICAgIH0sXG5cbiAgICAgICAgLyoqXG4gICAgICAgICAqIEZpcmVzIGluIHByZXNzaW5nIGEga2V5IHdpdGhpbiB0aGUgYWRkIHN0YXRlIHRleHQgZmllbGQuXG4gICAgICAgICAqXG4gICAgICAgICAqIEBzaW5jZSB7e1ZFUlNJT059fVxuICAgICAgICAgKlxuICAgICAgICAgKiBAcGFyYW0gZVxuICAgICAgICAgKi9cbiAgICAgICAgYWRkX3N0YXRlX2tleXByZXNzOiBmdW5jdGlvbiAoZSkge1xuXG4gICAgICAgICAgICBpZiAoZS53aGljaCA9PT0gMTMpIHtcblxuICAgICAgICAgICAgICAgIGUucHJldmVudERlZmF1bHQoKTtcbiAgICAgICAgICAgICAgICBhcGkuc2F2ZV9zdGF0ZSgpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9LFxuXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBTYXZlcyBhIHN0YXRlLlxuICAgICAgICAgKlxuICAgICAgICAgKiBAc2luY2Uge3tWRVJTSU9OfX1cbiAgICAgICAgICovXG4gICAgICAgIHNhdmVfc3RhdGU6IGZ1bmN0aW9uIChlKSB7XG5cbiAgICAgICAgICAgIHZhciBuYW1lID0gYXBpLmVsZW1lbnRzLmZpZWxkX25hbWUudmFsKCk7XG5cbiAgICAgICAgICAgIGFwaS5zZXRfbG9hZGluZygpO1xuXG4gICAgICAgICAgICAkLnBvc3QoXG4gICAgICAgICAgICAgICAgYWpheHVybCxcbiAgICAgICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgICAgIGFjdGlvbjogJ3BsdWdpbnNzX2FkZF9zdGF0ZScsXG4gICAgICAgICAgICAgICAgICAgIG5hbWU6IG5hbWUsXG4gICAgICAgICAgICAgICAgICAgIG5vbmNlOiBQbHVnaW5TU19EYXRhLm5vbmNlXG4gICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICBmdW5jdGlvbiAocmVzcG9uc2UpIHtcblxuICAgICAgICAgICAgICAgICAgICB2YXIgJG5vdGljZSA9IGFwaS5lbGVtZW50cy5ub3RpY2VzLmZpbmQoJy5wbHVnaW5zcy1ub3RpY2UtZHVtbXknKS5jbG9uZSgpO1xuXG4gICAgICAgICAgICAgICAgICAgIGlmICh0eXBlb2YgcmVzcG9uc2Uuc3VjY2VzcyA9PSAndW5kZWZpbmVkJyB8fCAhcmVzcG9uc2Uuc3VjY2Vzcykge1xuXG4gICAgICAgICAgICAgICAgICAgICAgICAkbm90aWNlLmFkZENsYXNzKCdlcnJvcicpLmZpbmQoJ3AnKS5odG1sKHJlc3BvbnNlLmRhdGEubWVzc2FnZSk7XG5cbiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcblxuICAgICAgICAgICAgICAgICAgICAgICAgJG5vdGljZS5hZGRDbGFzcygndXBkYXRlZCcpLmZpbmQoJ3AnKS5odG1sKHJlc3BvbnNlLmRhdGEubWVzc2FnZSk7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgIGFwaS5lbGVtZW50cy5maWVsZF9zdGF0ZS5hcHBlbmQoXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgJzxvcHRpb24gdmFsdWU9XCInICsgcmVzcG9uc2UuZGF0YS5pZCArICdcIiBzZWxlY3RlZCBkYXRhLWFjdGl2ZT1cIjFcIj4nICtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXNwb25zZS5kYXRhLm5hbWUgKyAnPC9vcHRpb24+J1xuICAgICAgICAgICAgICAgICAgICAgICAgKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgICAgIGFwaS5zZXRfZm9ybV9kaXNwbGF5KCk7XG5cbiAgICAgICAgICAgICAgICAgICAgYXBpLmVsZW1lbnRzLmZpZWxkX25hbWUudmFsKCcnKTtcblxuICAgICAgICAgICAgICAgICAgICBhcGkudW5zZXRfbG9hZGluZygpO1xuXG4gICAgICAgICAgICAgICAgICAgICRub3RpY2UucmVtb3ZlQ2xhc3MoJ3BsdWdpbnNzLW5vdGljZS1kdW1teScpLmFwcGVuZFRvKGFwaS5lbGVtZW50cy5ub3RpY2VzKS5zaG93KCk7XG5cbiAgICAgICAgICAgICAgICAgICAgc2V0VGltZW91dChmdW5jdGlvbiAoKSB7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgICRub3RpY2Uuc2xpZGVVcCgzMDAsIGZ1bmN0aW9uICgpIHtcblxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICQodGhpcykucmVtb3ZlKCk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgICAgICAgICB9LCA1MDAwKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICApXG4gICAgICAgIH0sXG5cbiAgICAgICAgLyoqXG4gICAgICAgICAqIERlbGV0ZXMgdGhlIGN1cnJlbnQgc3RhdGUuXG4gICAgICAgICAqXG4gICAgICAgICAqIEBzaW5jZSB7e1ZFUlNJT059fVxuICAgICAgICAgKi9cbiAgICAgICAgZGVsZXRlX3N0YXRlOiBmdW5jdGlvbiAoKSB7XG5cbiAgICAgICAgICAgIHZhciBjdXJyZW50X3N0YXRlID0gYXBpLmVsZW1lbnRzLmZpZWxkX3N0YXRlLmZpbmQoJ29wdGlvbjpzZWxlY3RlZCcpLnZhbCgpO1xuXG4gICAgICAgICAgICBhcGkuc2V0X2xvYWRpbmcoKTtcblxuICAgICAgICAgICAgJC5wb3N0KFxuICAgICAgICAgICAgICAgIGFqYXh1cmwsXG4gICAgICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgICAgICBhY3Rpb246ICdwbHVnaW5zc19kZWxldGVfc3RhdGUnLFxuICAgICAgICAgICAgICAgICAgICBpZDogY3VycmVudF9zdGF0ZSxcbiAgICAgICAgICAgICAgICAgICAgbm9uY2U6IFBsdWdpblNTX0RhdGEubm9uY2VcbiAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgIGZ1bmN0aW9uIChyZXNwb25zZSkge1xuXG4gICAgICAgICAgICAgICAgICAgIHZhciAkbm90aWNlID0gYXBpLmVsZW1lbnRzLm5vdGljZXMuZmluZCgnLnBsdWdpbnNzLW5vdGljZS1kdW1teScpLmNsb25lKCk7XG5cbiAgICAgICAgICAgICAgICAgICAgaWYgKHR5cGVvZiByZXNwb25zZS5zdWNjZXNzID09ICd1bmRlZmluZWQnIHx8ICFyZXNwb25zZS5zdWNjZXNzKSB7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgICRub3RpY2UuYWRkQ2xhc3MoJ2Vycm9yJykuZmluZCgncCcpLmh0bWwocmVzcG9uc2UuZGF0YS5tZXNzYWdlKTtcblxuICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xuXG4gICAgICAgICAgICAgICAgICAgICAgICAkbm90aWNlLmFkZENsYXNzKCd1cGRhdGVkJykuZmluZCgncCcpLmh0bWwocmVzcG9uc2UuZGF0YS5tZXNzYWdlKTtcblxuICAgICAgICAgICAgICAgICAgICAgICAgYXBpLmVsZW1lbnRzLmZpZWxkX3N0YXRlLmZpbmQoJ29wdGlvbjpzZWxlY3RlZCcpLnJlbW92ZSgpO1xuICAgICAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICAgICAgYXBpLnNldF9mb3JtX2Rpc3BsYXkoKTtcblxuICAgICAgICAgICAgICAgICAgICBhcGkudW5zZXRfbG9hZGluZygpO1xuXG4gICAgICAgICAgICAgICAgICAgICRub3RpY2UucmVtb3ZlQ2xhc3MoJ3BsdWdpbnNzLW5vdGljZS1kdW1teScpLmFwcGVuZFRvKGFwaS5lbGVtZW50cy5ub3RpY2VzKS5zaG93KCk7XG5cbiAgICAgICAgICAgICAgICAgICAgc2V0VGltZW91dChmdW5jdGlvbiAoKSB7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgICRub3RpY2Uuc2xpZGVVcCgzMDAsIGZ1bmN0aW9uICgpIHtcblxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICQodGhpcykucmVtb3ZlKCk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgICAgICAgICB9LCA1MDAwKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICApXG4gICAgICAgIH0sXG5cbiAgICAgICAgLyoqXG4gICAgICAgICAqIEZpcmVzIHdoZW4gY2hhbmdpbmcgdGhlIGxvYWQgc3RhdGUgc2VsZWN0b3IuXG4gICAgICAgICAqXG4gICAgICAgICAqIEBzaW5jZSB7e1ZFUlNJT059fVxuICAgICAgICAgKi9cbiAgICAgICAgY2hhbmdlX3N0YXRlX3NlbGVjdG9yOiBmdW5jdGlvbiAoKSB7XG5cbiAgICAgICAgICAgIGFwaS5zZXRfZm9ybV9kaXNwbGF5KCk7XG4gICAgICAgIH0sXG5cbiAgICAgICAgLyoqXG4gICAgICAgICAqIFNldHMgdGhlIGZvcm0gdG8gbG9hZGluZy5cbiAgICAgICAgICpcbiAgICAgICAgICogQHNpbmNlIHt7VkVSU0lPTn19XG4gICAgICAgICAqL1xuICAgICAgICBzZXRfbG9hZGluZzogZnVuY3Rpb24gKCkge1xuXG4gICAgICAgICAgICB2YXIgJGlucHV0cyA9IGFwaS5lbGVtZW50cy5zd2l0Y2hlci5maW5kKCdpbnB1dCwgc2VsZWN0LCBidXR0b24nKTtcblxuICAgICAgICAgICAgJGlucHV0cy5wcm9wKCdkaXNhYmxlZCcsIHRydWUpO1xuXG4gICAgICAgICAgICBhcGkuZWxlbWVudHMuc3dpdGNoZXIuZmluZCgnLnBsdWdpbnNzLWZvcm0nKS5hcHBlbmQoJzxzcGFuIGNsYXNzPVwic3Bpbm5lciBpcy1hY3RpdmVcIj48L3NwYW4+Jyk7XG4gICAgICAgIH0sXG5cbiAgICAgICAgLyoqXG4gICAgICAgICAqIFVuc2V0cyB0aGUgZm9ybSBmcm9tIGxvYWRpbmcuXG4gICAgICAgICAqXG4gICAgICAgICAqIEBzaW5jZSB7e1ZFUlNJT059fVxuICAgICAgICAgKi9cbiAgICAgICAgdW5zZXRfbG9hZGluZzogZnVuY3Rpb24gKCkge1xuXG4gICAgICAgICAgICB2YXIgJGlucHV0cyA9IGFwaS5lbGVtZW50cy5zd2l0Y2hlci5maW5kKCdpbnB1dCwgc2VsZWN0LCBidXR0b24nKSxcbiAgICAgICAgICAgICAgICAkc3Bpbm5lciA9IGFwaS5lbGVtZW50cy5zd2l0Y2hlci5maW5kKCcuc3Bpbm5lcicpO1xuXG4gICAgICAgICAgICAkaW5wdXRzLnByb3AoJ2Rpc2FibGVkJywgZmFsc2UpO1xuXG4gICAgICAgICAgICAkc3Bpbm5lci5yZW1vdmUoKTtcbiAgICAgICAgfSxcblxuICAgICAgICAvKipcbiAgICAgICAgICogSGlkZXMvc2hvd3MgcGFydCBvZiB0aGUgZm9ybSBiYXNlZCBvbiB0aGUgY29uZGl0aW9ucy5cbiAgICAgICAgICpcbiAgICAgICAgICogQHNpbmNlIHt7VkVSU0lPTn19XG4gICAgICAgICAqL1xuICAgICAgICBzZXRfZm9ybV9kaXNwbGF5OiBmdW5jdGlvbiAoKSB7XG5cbiAgICAgICAgICAgIGlmICghYXBpLmVsZW1lbnRzLmZpZWxkX3N0YXRlLmZpbmQoJ29wdGlvbicpLmxlbmd0aCkge1xuXG4gICAgICAgICAgICAgICAgYXBpLmVsZW1lbnRzLmZpZWxkc2V0X21hbmFnZS5oaWRlKCk7XG5cbiAgICAgICAgICAgIH0gZWxzZSB7XG5cbiAgICAgICAgICAgICAgICBhcGkuZWxlbWVudHMuZmllbGRzZXRfbWFuYWdlLnNob3coKTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgaWYgKGFwaS5lbGVtZW50cy5maWVsZF9zdGF0ZS5maW5kKCdvcHRpb25bZGF0YS1hY3RpdmU9XCIxXCJdJykubGVuZ3RoKSB7XG5cbiAgICAgICAgICAgICAgICBhcGkuZWxlbWVudHMuZmllbGRzZXRfYWRkLmhpZGUoKTtcbiAgICAgICAgICAgICAgICBhcGkuZWxlbWVudHMuZmllbGRzZXRfbWFuYWdlLnJlbW92ZUNsYXNzKCdyaWdodC1wYWRkZWQnKTtcblxuICAgICAgICAgICAgfSBlbHNlIHtcblxuICAgICAgICAgICAgICAgIGFwaS5lbGVtZW50cy5maWVsZHNldF9hZGQuc2hvdygpO1xuICAgICAgICAgICAgICAgIGFwaS5lbGVtZW50cy5maWVsZHNldF9tYW5hZ2UuYWRkQ2xhc3MoJ3JpZ2h0LXBhZGRlZCcpO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBpZiAoYXBpLmVsZW1lbnRzLmZpZWxkX3N0YXRlLmZpbmQoJ29wdGlvbjpzZWxlY3RlZCcpLmF0dHIoJ2RhdGEtYWN0aXZlJykpIHtcblxuICAgICAgICAgICAgICAgIGFwaS5lbGVtZW50cy5idXR0b25fbG9hZC5oaWRlKCk7XG5cbiAgICAgICAgICAgIH0gZWxzZSB7XG5cbiAgICAgICAgICAgICAgICBhcGkuZWxlbWVudHMuYnV0dG9uX2xvYWQuc2hvdygpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgfTtcblxuICAgICQoYXBpLmluaXQpO1xuXG59KShqUXVlcnkpOyJdfQ==
